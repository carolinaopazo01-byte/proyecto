{% extends "base/plantillados.html" %}
{% block title %}Asistencia (semana){% endblock %}
{% block header %}Asistencia (semana){% endblock %}

{% block extra_css %}
<style>
  .page-head{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:.75rem}
  .kpi-wrap{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-bottom:12px}
  .kpi{background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:12px}
  .kpi small{color:#6b7280;display:block;margin-bottom:4px}
  .kpi b{font-size:1.1rem}
  .filters{display:grid;grid-template-columns:180px auto auto;gap:10px;align-items:end}
  @media (max-width:768px){.filters{grid-template-columns:1fr}}
</style>
{% endblock %}

{% block content %}

  <!-- Cabecera simple -->
  <div class="page-head">
    <h4 class="mb-0">Asistencia (semanal)</h4>
  </div>

  <!-- Filtros + navegaciÃ³n de semanas -->
  <form method="get" class="card p-3 mb-3">
    <div class="filters">
      <div>
        <label class="form-label mb-1">Semana</label>
        <input type="date" name="semana" value="{{ semana }}" class="form-control">
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <a class="btn btn-outline-secondary" href="?semana={{ semana_anterior }}">Â« Semana anterior</a>
        <a class="btn btn-outline-secondary" href="?semana={{ semana_siguiente }}">Semana siguiente Â»</a>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button class="btn btn-primary" type="submit">Filtrar</button>
      </div>
    </div>
  </form>

  <p class="text-muted">Del <strong>{{ desde|date:"d/m" }}</strong> al <strong>{{ hasta|date:"d/m" }}</strong>.</p>

  <!-- KPIs -->
  <div class="kpi-wrap">
    <div class="kpi">
      <small>ðŸ“‰ Inasistencias histÃ³ricas</small>
      <b>{{ kpi_total_inasist }}</b>
    </div>
    <div class="kpi">
      <small>ðŸš© Inasistencias semana</small>
      <b>{{ kpi_semana_inasist }}</b>
    </div>
    <div class="kpi">
      <small>ðŸ“ˆ % asistencia del mes</small>
      <b>{{ kpi_pct_mes }}%</b>
    </div>
  </div>

  <!-- Tabla -->
  {% if items %}
    <div class="card shadow-sm">
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="thead-light">
              <tr>
                <th>Fecha</th>
                <th>Inicio</th>
                <th>Fin</th>
                <th>Profesor</th>
                <th>Asistencia</th>
              </tr>
            </thead>
            <tbody>
              {% for a in items %}
                <tr>
                  <td>{{ a.clase.fecha|date:"d/m" }}</td>
                  <td>{{ a.clase.hora_inicio }}</td>
                  <td>{{ a.clase.hora_fin }}</td>
                  <td>{{ a.clase.profesor.get_full_name|default:a.clase.profesor.username }}</td>
                  <td>
                    {% if a.presente %}
                      <span class="badge badge-success">Presente</span>
                    {% else %}
                      <span class="badge badge-secondary">Ausente</span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info mb-0">No hay registros esta semana.</div>
  {% endif %}

{% endblock %}
