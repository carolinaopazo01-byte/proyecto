{% extends "base/plantilla.html" %}
{% load static %}

{% block title %}Tomar hora (PMUL){% endblock %}

{% block extra_css %}
<style>
  .page-head{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:.75rem}
  .page-head h4{margin:0;font-weight:800;font-size:1.05rem;letter-spacing:.2px}
</style>
{% endblock %}

{% block content %}
  <div class="page-head">
    <h4>Horas disponibles</h4>
    <div class="page-actions">
      <a class="btn btn-outline-secondary btn-sm" href="?desde={% now 'Y-m-d' %}">
        Hoy
      </a>
    </div>
  </div>

  <!-- Filtros -->
  <form class="row g-2 mb-3" method="get">
    <div class="col-auto">
      <label class="form-label mb-0 small">Desde</label>
      <input type="date" name="desde" value="{{ request.GET.desde }}" class="form-control form-control-sm">
    </div>
    <div class="col-auto">
      <label class="form-label mb-0 small">Profesional / especialidad</label>
      <input type="text" name="q" value="{{ request.GET.q }}" class="form-control form-control-sm" placeholder="Ej: nutri, kine, nombre…">
    </div>
    <div class="col-auto align-self-end">
      <button class="btn btn-primary btn-sm" type="submit">
        <i class="fas fa-search"></i> Buscar
      </button>
    </div>
  </form>

  {% if items %}
    <div class="card shadow-sm">
      <div class="table-responsive">
        <table class="table table-hover mb-0 align-middle">
          <thead class="thead-light">
            <tr>
              <th>Fecha</th>
              <th>Horario</th>
              <th>Profesional</th>
              <th>Especialidad</th>
              <th>Piso</th>
              <th class="text-end">Acción</th>
            </tr>
          </thead>
          <tbody>
            {% for s in items %}
              <tr>
                <td>{{ s.inicio|date:"d/m/Y" }}</td>
                <td>{{ s.inicio|time:"H:i" }}–{{ s.fin|time:"H:i" }}</td>
                <td>{% firstof s.profesional.get_full_name s.profesional.username "—" %}</td>
                <td>
                  {% if s.profesional.perfil_pmul %}
                    {{ s.profesional.perfil_pmul.get_especialidad_display }}
                  {% else %}—{% endif %}
                </td>
                <td>{{ s.piso|default:"—" }}</td>
                <td class="text-end">
                  <form method="post" action="{% url 'atleta:reservar_hora' s.id %}">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-primary">
                      <i class="fas fa-check"></i> Reservar
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info mb-0">
      No hay horas disponibles con los filtros actuales.
    </div>
  {% endif %}

  <div class="mt-3">
    <a class="btn btn-outline-secondary btn-sm" href="{% url 'atleta:mis_citas' %}">
      <i class="fas fa-calendar-check"></i> Ver mis citas
    </a>
  </div>
{% endblock %}

{% block extra_js %}{% endblock %}
