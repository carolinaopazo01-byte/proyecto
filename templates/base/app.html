{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" href="{% static 'img/logo/mi_logo.png' %}">
  <title>{% block title %}CPC - Dashboard{% endblock %}</title>

  <!-- CSS global -->
  <link href="{% static 'vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700;800&display=swap" rel="stylesheet">
  <link href="{% static 'css/cpc-uniform.css' %}" rel="stylesheet">

  <style>
    :root{
      --topbar-h:56px; --brand-h:56px;
      --sb-w-desktop:220px; --sb-w-mobile:260px;
      --rhythm:18px;
      --bg:#f3f4f6; --text:#223146; --cpc-sea:#A1B2AE;
      --card-bg:#fff; --card-br:#eef2f7; --card-radius:12px; --card-shadow:0 2px 6px rgba(0,0,0,.04);
    }

    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:"Manrope",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    }

    /* ===== LAYOUT ===== */
    .app{min-height:100dvh; display:flex;}

    /* ===== SIDEBAR ===== */
    .sidebar{
      width:var(--sb-w-desktop); flex:0 0 var(--sb-w-desktop);
      background:#fff; border-right:1px solid var(--card-br);
      display:flex; flex-direction:column; z-index:900;
    }
    /* Sin logo en el lateral izquierdo */
    .sb-brand{
      height:var(--brand-h); padding:0 12px;
      display:flex; align-items:center; justify-content:space-between;
      background:#fff; border-bottom:none;
    }
    .sb-scroll{flex:1 1 auto; padding:var(--rhythm) 12px; overflow:hidden; background: var(--bg);}

    /* ===== MINI PERFIL (nombre + correo, fijo en el sidebar) ===== */
    .sb-profile{
      display:flex; align-items:center; gap:.6rem;
      background:#fff; border:1px solid #eef2f7; border-radius:12px;
      padding:.55rem .7rem; margin-bottom:var(--rhythm);
      box-shadow:var(--card-shadow);
    }
    .sb-profile-avatar{
      width:34px; height:34px; border-radius:10px;
      display:inline-flex; align-items:center; justify-content:center;
      background:#eef6ff; color:#3b82f6; flex:0 0 34px;
    }
    .sb-profile-avatar i{ font-size:16px; line-height:1; }
    .sb-profile-info{ min-width:0; }
    .sb-profile-name{
      font-weight:800; font-size:.9rem; color:#1f2937;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; line-height:1.15;
    }
    .sb-profile-mail{
      font-size:.78rem; color:#6b7280;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; line-height:1.2;
    }

    .sb-section{
      background:var(--card-bg); border:1px solid var(--card-br);
      border-radius:var(--card-radius); box-shadow:var(--card-shadow);
      overflow:hidden; margin-bottom: var(--rhythm);
    }
    .sb-head{
      display:flex; gap:6px; align-items:center;
      padding:10px 12px; background:#f8fafc; border-bottom:1px solid var(--card-br);
      font-weight:900; font-size:12px; color:#223146;
    }
    .sb-head i{ width:14px; text-align:center; font-size:12px; }
    .sb-body{ padding:8px; display:flex; flex-direction:column; gap:8px; }

    .sb-link{
      display:flex; align-items:center; gap:8px; padding:8px 10px;
      border-radius:10px; font-weight:700; color:#3b4656; border:1px solid transparent;
      text-decoration:none; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .sb-link i{ width:14px; min-width:14px; text-align:center; color:#7b8797; font-size:13px; }
    .sb-link:hover{ background:rgba(16,165,170,.08); color:#056375; border-color:#cfe9ec; }
    .sb-link:hover i{ color:#056375; }

    .sb-foot{ margin-top:auto; border-top:1px solid var(--card-br); background:#fff; padding: var(--rhythm) 10px; }
    .sb-logout{
      display:flex; gap:8px; align-items:center; justify-content:center;
      padding:9px 10px; border-radius:10px; font-weight:800;
      color:#dc2626; border:1px solid #fecaca; background:#fff; text-decoration:none;
    }
    .sb-logout:hover{ background:#fee2e2; color:#b91c1c; border-color:#fca5a5; }
    .sb-meta{ color:#94a3b8; font-size:.72rem; text-align:center; margin-top:8px; }

    /* ===== CONTENIDO ===== */
    .content{ flex:1 1 auto; display:flex; flex-direction:column; min-width:0; }
    .topbar{
      height:var(--topbar-h); display:flex; align-items:center;
      border-bottom:1px solid var(--cpc-sea); background:#fff;
      padding:0 12px; position:relative; z-index:1000;
    }
    /* Logo completo y pequeño a la derecha (sin nombre) */
    .topbar-logo{
      height:28px; width:auto; border-radius:0; display:block; object-fit:contain;
    }

    .container-page{ flex:1 1 auto; padding:var(--rhythm) 16px; }
    .container-page > *:first-child{ margin-top:0; }
    footer.footer{ background:linear-gradient(90deg,#0B5A66 0%,#0A5A64 100%); color:#fff; }

    /* ===== Botón global (SIEMPRE visible) ===== */
    #menuBtn{
      position:fixed; top:8px; left:8px;
      display:inline-flex; align-items:center; justify-content:center;
      width:36px; height:36px; border:none; background:transparent; color:#94a3b8;
      padding:0; margin:0; line-height:1; border-radius:8px;
      box-shadow:none;
      z-index:2147483647;
      cursor:pointer;
    }
    #menuBtn .icon-bars{ width:22px; height:22px; display:inline-block; }
    #menuBtn svg path{ stroke:currentColor; stroke-width:2; fill:none; stroke-linecap:round; }
    #menuBtn:focus{ outline:none; }

    /* ===== Responsive ===== */
    @media (max-width: 991.98px){
      .sidebar{
        position:fixed; left:0; top:0; bottom:0;
        width:var(--sb-w-mobile);
        transform:translateX(-100%); transition:none; background:#fff; z-index:1000;
      }
      body.nav-open .sidebar{ transform:translateX(0); }
      .sb-brand{ padding-left:56px; } /* evita solape con el botón fijo */
    }
    @media (min-width: 992px){
      .sidebar{ position:relative; transform:none; transition:none; }
    }

    /* ===== Tipografía del SIDEBAR ===== */
    .sidebar{ font-size:12.5px; }
    .sb-head{ font-size:14px; font-weight:900; letter-spacing:.2px; padding:8px 10px; }
    .sb-link{ font-size:12.5px; padding:7px 10px; }
    .sb-link i{ font-size:12px; width:14px; min-width:14px; }
    .sb-meta{ font-size:11.5px; }
    .sb-logout{ font-size:12.5px; }
    @media (max-width: 991.98px){
      .sb-head{ padding:10px 12px; font-size:14px; }
      .sb-link{ padding:10px 12px; font-size:12.5px; }
    }
  </style>

  {% block extra_css %}{% endblock %}
</head>
<body>

<!-- Botón global SIEMPRE visible -->
<button id="menuBtn" aria-label="Abrir menú" aria-expanded="false">
  <svg class="icon-bars" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M3 6h18M3 12h18M3 18h18"/>
  </svg>
</button>

<div class="app" id="app">

  <!-- ===== SIDEBAR ===== -->
  <aside class="sidebar" id="sidebar" aria-label="Barra lateral">
    <div class="sb-brand"></div> <!-- sin logo a la izquierda -->

    <div class="sb-scroll">
      <!-- MINI PERFIL: nombre + correo -->
      <div class="sb-profile">
        <div class="sb-profile-avatar" aria-hidden="true">
          <i class="fas fa-user"></i>
        </div>
        <div class="sb-profile-info">
          <div class="sb-profile-name">
            {{ request.user.get_full_name|default:request.user.username }}
          </div>
          <div class="sb-profile-mail">
            {{ request.user.email|default:"Sin correo" }}
          </div>
        </div>
      </div>

      <!-- Gestión de estudiantes -->
      <section class="sb-section">
        <div class="sb-head"><i class="fas fa-user-graduate"></i><span>Gestión de estudiantes</span></div>
        <div class="sb-body">
          <a class="sb-link" href="{% url 'core:estudiantes_list' %}">
            <i class="fas fa-list-ul"></i><span>Registros</span>
          </a>
        </div>
      </section>

      <!-- Gestión de cursos -->
      <section class="sb-section">
        <div class="sb-head"><i class="fas fa-layer-group"></i><span>Gestión de cursos</span></div>
        <div class="sb-body">
          <a class="sb-link" href="{% url 'core:cursos_list' %}"><i class="fas fa-table"></i><span>Registros de cursos</span></a>
          <a class="sb-link" href="{% url 'core:planificaciones_list' %}"><i class="fas fa-clipboard-check"></i><span>Planificaciones</span></a>
          <a class="sb-link" href="{% url 'core:sedes_list' %}"><i class="fas fa-map-marker-alt"></i><span>Sedes</span></a>
        </div>
      </section>

      <!-- Gestión de usuarios -->
      <section class="sb-section">
        <div class="sb-head"><i class="fas fa-id-badge"></i><span>Gestión de usuarios</span></div>
        <div class="sb-body">
          <a class="sb-link" href="{% url 'usuarios:equipo_list' %}">
            <i class="fas fa-users-cog"></i><span>Equipo</span>
          </a>
        </div>
      </section>

      <!-- Reportes -->
      <section class="sb-section">
        <div class="sb-head"><i class="fas fa-chart-bar"></i><span>Reportes</span></div>
        <div class="sb-body">
          <a class="sb-link" href="{% url 'core:reportes_home' %}">
            <i class="fas fa-file-alt"></i><span>Centro de reportes</span>
          </a>
        </div>
      </section>

      <!-- Comunicados: SOLO en el sidebar -->
      <section class="sb-section">
        <div class="sb-head"><i class="fas fa-bullhorn"></i><span>Comunicados</span></div>
        <div class="sb-body">
          <a class="sb-link" href="{% url 'core:comunicados_list' %}">
            <i class="fas fa-envelope-open-text"></i><span>Ver comunicados</span>
          </a>
        </div>
      </section>
    </div>

    <div class="sb-foot">
      <a class="sb-logout" href="{% url 'usuarios:logout' %}">
        <i class="fas fa-sign-out-alt"></i><span>Cerrar sesión</span>
      </a>
      <div class="sb-meta">© {% now "Y" %}</div>
    </div>
  </aside>

  <!-- ===== CONTENIDO ===== -->
  <main class="content">
    <nav class="topbar">
      <!-- Solo logo (pequeño) a la derecha; SIN nombre -->
      <div class="ml-auto d-flex align-items-center">
        <img src="{% static 'img/logo/mi_logo.png' %}" class="topbar-logo" alt="Logo CPC">
      </div>
    </nav>

    <div class="container-page">
      {% block content %}{% endblock %}
    </div>

    <footer class="footer py-3">
      <div class="container text-center">
        <span>Desarrollado por <b>Campeones Para Coquimbo</b></span>
      </div>
    </footer>
  </main>
</div>

<!-- JS global -->
<script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

<!-- Toggle: usa el botón global y clase en <body> -->
<script>
  (function(){
    var menuBtn = document.getElementById('menuBtn');

    function toggleSidebar(e){
      if(e) e.preventDefault();
      var open = document.body.classList.toggle('nav-open');
      menuBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
    }

    if(menuBtn){
      menuBtn.addEventListener('click', toggleSidebar);
    }

    // Limpia estado al pasar a desktop
    var mq = window.matchMedia('(min-width: 992px)');
    function clean(){
      if(mq.matches){
        document.body.classList.remove('nav-open');
        if(menuBtn) menuBtn.setAttribute('aria-expanded','false');
      }
    }
    if(mq.addEventListener){ mq.addEventListener('change', clean); } else { mq.addListener(clean); }
  })();
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
