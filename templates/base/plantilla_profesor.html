{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" href="{% static 'img/logo/mi_logo.png' %}">
  <title>{% block title %}CPC - Profesor{% endblock %}</title>

  <!-- CSS global -->
  <link href="{% static 'vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet">
  <link href="{% static 'vendor/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;600;700;800&display=swap" rel="stylesheet">
  <link href="{% static 'css/cpc-uniform.css' %}" rel="stylesheet">

  <style>
    :root{
      --topbar-h:56px; --brand-h:56px;
      --sb-w-desktop:220px; --sb-w-mobile:260px;
      --rhythm:18px;

      /* Neutros */
      --bg:#f5f7fb; --surface:#ffffff; --line:#e5e7eb;
      --text:#1f2937; --text-weak:#6b7280;

      /* Paleta CPC (teal) */
      --primary-50:#e8f6f7; --primary-100:#d6eff1; --primary-200:#aee0e5; --primary-300:#7fcfd6;
      --primary-400:#3fb6c0; --primary-500:#159aa7; --primary-600:#0e7c86; --primary-700:#0a5a64; --primary-800:#083f49;

      --card-br:#cfe7ea; --card-shadow:0 2px 6px rgba(0,0,0,.04);
      --elev-shadow-1:0 2px 10px rgba(17,24,39,.10);
      --elev-shadow-2:0 1px 2px rgba(17,24,39,.06);
      --elev-shadow:var(--elev-shadow-1),var(--elev-shadow-2);

      --bar-color: var(--primary-700);
      --bar-text: #ffffff;
    }

    html,body{height:100%;}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:"Manrope",system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    .app{min-height:100dvh; display:flex;}

    /* Sidebar */
    .sidebar{
      width:var(--sb-w-desktop); flex:0 0 var(--sb-w-desktop);
      background: var(--surface);
      display:flex; flex-direction:column; z-index:900;
      box-shadow:none;
    }
    .sidebar.sb-elevated{ box-shadow: var(--elev-shadow); }

    .sb-brand{
      height:var(--brand-h);
      padding:0 12px;
      display:flex; align-items:center; justify-content:space-between;
      background: var(--bar-color) !important; color: var(--bar-text);
    }
    .sb-brand, .sb-brand *{ color: var(--bar-text); }

    .sb-scroll{flex:1 1 auto; padding:var(--rhythm) 12px; overflow:hidden; background: var(--surface);}

    .sb-profile{
      display:flex; align-items:center; gap:.6rem;
      border:1px solid var(--card-br); border-radius:12px; background:#fff;
      padding:.55rem .7rem; margin-bottom:var(--rhythm);
      box-shadow:var(--card-shadow);
    }
    .sb-profile-avatar{
      width:34px; height:34px; border-radius:10px; display:inline-flex; align-items:center; justify-content:center;
      background:var(--primary-50); color:var(--primary-600); flex:0 0 34px;
    }
    .sb-profile-name{ font-weight:800; font-size:.9rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .sb-profile-mail{ font-size:.78rem; color:var(--text-weak); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    .sb-section{
      background:#fff; border:1px solid var(--card-br); border-radius:12px;
      box-shadow:var(--card-shadow); overflow:hidden; margin-bottom:var(--rhythm);
    }
    .sb-head{
      display:flex; gap:6px; align-items:center; padding:10px 12px;
      background:var(--primary-50); color:var(--primary-700);
      font-weight:900; font-size:12px;
    }
    .sb-body{ padding:8px; display:flex; flex-direction:column; gap:8px; }

    .sb-link{
      display:flex; align-items:center; gap:8px; padding:8px 10px; border-radius:10px;
      font-weight:700; color:#3b4656; border:1px solid transparent; text-decoration:none;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; background:transparent;
    }
    .sb-link i{ width:14px; min-width:14px; text-align:center; color:#7b8797; font-size:13px; }
    .sb-link:hover{
      background:var(--primary-50); color:var(--primary-700); border-color: var(--primary-200);
    }
    .sb-link:hover i{ color:var(--primary-700); }

    .sb-foot{ margin-top:auto; background:var(--surface); padding: var(--rhythm) 10px; }
    .sb-logout{
      display:flex; gap:8px; align-items:center; justify-content:center; padding:9px 10px; border-radius:10px;
      font-weight:800; color:#b91c1c; border:1px solid #f5caca; background:#fff; text-decoration:none;
    }
    .sb-logout:hover{ background:#fff4f4; border-color:#f0b5b5; }
    .sb-meta{ color:#94a3b8; font-size:.72rem; text-align:center; margin-top:8px; }

    /* Content / Topbar */
    .content{ flex:1 1 auto; display:flex; flex-direction:column; min-width:0; }
    .topbar{
      height:var(--topbar-h); display:flex; align-items:center;
      background:var(--bar-color) !important; color:var(--bar-text);
      box-shadow: var(--elev-shadow);
      padding:0 12px; position:sticky; top:max(env(safe-area-inset-top,0px),0px); z-index:1000;
    }
    .topbar, .topbar *{ color: var(--bar-text); }
    .topbar-logo{ height:28px; width:auto; display:block; object-fit:contain; }

    .container-page{ flex:1 1 auto; padding:var(--rhythm) 16px; }
    .container-page > *:first-child{ margin-top:0; }

    footer.footer{ background: var(--bar-color) !important; color:#ffffff !important; }
    footer.footer b{ color:#ffffff !important; }

    /* Hamburguesa */
    #menuBtn{
      position:fixed; top:8px; left:8px; display:inline-flex; align-items:center; justify-content:center;
      width:36px; height:36px; border:none; background:transparent; color: var(--bar-text);
      padding:0; margin:0; line-height:1; border-radius:8px; box-shadow:none; z-index:2147483647; cursor:pointer;
      transition:opacity .18s ease, transform .18s ease, visibility .18s ease;
    }
    #menuBtn .icon-bars{ width:22px; height:22px; display:inline-block; }
    #menuBtn svg path{ stroke:currentColor; stroke-width:2; fill:none; stroke-linecap:round; }
    #menuBtn.is-hidden{ opacity:0; visibility:hidden; pointer-events:none; transform:translateY(-8px); }
    @media (min-width: 992px){ #menuBtn{ display:none; } }

    /* Responsive */
    @media (max-width: 991.98px){
      .sidebar{
        position:fixed; left:0; top:0; bottom:0; width:var(--sb-w-mobile);
        transform:translateX(-100%); background:#fff; z-index:1000;
      }
      body.nav-open .sidebar{ transform:translateX(0); }
      .sb-brand{ padding-left:56px; }
      .sb-scroll{ padding-top: calc(var(--rhythm) + 12px); }
      .sb-profile{ margin-top: 4px; }
    }
    @media (min-width: 992px){
      .sidebar{ position:relative; transform:none; }
    }

    /* Tipografía sizes */
    .sidebar{ font-size:12.5px; }
    .sb-head{ font-size:14px; font-weight:900; letter-spacing:.2px; padding:8px 10px; }
    .sb-link{ font-size:12.5px; padding:7px 10px; }
    .sb-link i{ font-size:12px; width:14px; min-width:14px; }

    a{ color:var(--primary-600); } a:hover{ color:var(--primary-700); }
    .btn-primary{ background:var(--primary-600); border-color:var(--primary-600); }
    .btn-primary:hover,.btn-primary:focus{ background:var(--primary-700); border-color:var(--primary-700); }
    .form-control:focus{ border-color:var(--primary-300); box-shadow:0 0 0 3px rgba(21,154,167,.18); }
  </style>

  {% block extra_css %}{% endblock %}
</head>
<body>

<button id="menuBtn" aria-label="Abrir menú" aria-expanded="false">
  <svg class="icon-bars" viewBox="0 0 24 24" aria-hidden="true">
    <path d="M3 6h18M3 12h18M3 18h18"/>
  </svg>
</button>

<div class="app" id="app">

  <aside class="sidebar" id="sidebar" aria-label="Barra lateral">
    <div class="sb-brand" id="sbBrand"></div>

    <div class="sb-scroll">
      <!-- Mini perfil -->
      <div class="sb-profile">
        <div class="sb-profile-avatar" aria-hidden="true"><i class="fas fa-user"></i></div>
        <div>
          <div class="sb-profile-name">{{ request.user.get_full_name|default:request.user.username }}</div>
          <div class="sb-profile-mail">{{ request.user.email|default:"Sin correo" }}</div>
        </div>
      </div>

      <!-- ====== Sidebar Profesor (Panel) ====== -->
      <section class="sb-section">
        <div class="sb-head"><i class="fas fa-th-large"></i><span>Panel</span></div>
        <div class="sb-body">
          <!-- Tomar asistencia (listado) -->
          <a class="sb-link" href="{% url 'profesor:asistencia_profesor' %}">
            <i class="fas fa-user-check"></i><span>Tomar asistencia</span>
          </a>

          <!-- Marcar mi asistencia (QR) -->
          <a class="sb-link" href="{% url 'profesor:mi_asistencia_qr' %}">
            <i class="fas fa-qrcode"></i><span>Marcar mi asistencia (QR)</span>
          </a>

          <!-- Subir/gestionar planificaciones -->
          <a class="sb-link" href="{% url 'profesor:planificaciones_prof' %}">
            <i class="fas fa-clipboard-list"></i><span>Subir planificación</span>
          </a>

          <!-- Comunicados -->
          <a class="sb-link" href="{% url 'core:comunicados_list' %}">
            <i class="fas fa-bullhorn"></i><span>Comunicados</span>
          </a>

        <!--misestudiantes -->

<a class="sb-link" href="{% url 'core:estudiantes_list_prof' %}">
  <i class="fas fa-users"></i><span>Mis estudiantes</span>
</a>

          <!-- Mis cursos -->
          <a class="sb-link" href="{% url 'profesor:mis_cursos_prof' %}">
            <i class="fas fa-book"></i><span>Mis cursos</span>
          </a>

          <!-- Ingresar alumno temporalmente -->
          <a class="sb-link" href="{% url 'profesor:alumno_temporal_new' %}">
            <i class="fas fa-user-plus"></i><span>Ingresar alumno temporalmente</span>
          </a>

          <!-- Cambiar contraseña (NUEVO) -->
          <a class="sb-link" href="{% url 'usuarios:cambiar_password' %}">
            <i class="fas fa-key"></i><span>Cambiar contraseña</span>
          </a>
        </div>
      </section>
      <!-- ====== /Sidebar Profesor ====== -->
    </div>

    <div class="sb-foot">
      <a class="sb-logout" href="{% url 'usuarios:logout' %}"><i class="fas fa-sign-out-alt"></i><span>Cerrar sesión</span></a>
      <div class="sb-meta">© {% now "Y" %}</div>
    </div>
  </aside>

  <main class="content">
    <nav class="topbar" id="topbar">
      <div class="ml-auto d-flex align-items-center">
        <img src="{% static 'img/logo/mi_logo.png' %}" class="topbar-logo" alt="Logo CPC">
      </div>
    </nav>

    <div class="container-page">
      {% block content %}{% endblock %}
    </div>

    <footer class="footer py-3">
      <div class="container text-center">
        <span>Desarrollado por <b>Campeones Para Coquimbo</b></span>
      </div>
    </footer>
  </main>
</div>

<script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

<script>
  (function(){
    var menuBtn  = document.getElementById('menuBtn');
    var sidebar  = document.getElementById('sidebar');
    var sbBrand  = document.getElementById('sbBrand');

    if(sidebar) sidebar.classList.add('sb-elevated');

    function toggleSidebar(e){
      if(e) e.preventDefault();
      var open = document.body.classList.toggle('nav-open');
      if(menuBtn) menuBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
      if (open){
        if(menuBtn) menuBtn.classList.remove('is-hidden');
        if(sidebar) sidebar.classList.add('sb-elevated');
      }
    }
    if(menuBtn){ menuBtn.addEventListener('click', toggleSidebar); }

    var mq = window.matchMedia('(min-width: 992px)');
    function clean(){
      if(mq.matches){
        document.body.classList.remove('nav-open');
        if(menuBtn) menuBtn.setAttribute('aria-expanded','false');
      }
    }
    if(mq.addEventListener){ mq.addEventListener('change', clean); } else { mq.addListener(clean); }

    // Ocultar/mostrar hamburguesa en scroll (móvil)
    var lastY = window.pageYOffset || document.documentElement.scrollTop || 0;
    var threshold = 80;
    window.addEventListener('scroll', function(){
      if (!menuBtn) return;
      var y = window.pageYOffset || document.documentElement.scrollTop || 0;
      if (document.body.classList.contains('nav-open')) {
        menuBtn.classList.remove('is-hidden');
      } else {
        if (y > lastY && y > threshold){ menuBtn.classList.add('is-hidden'); }
        else { menuBtn.classList.remove('is-hidden'); }
      }
      lastY = y;
    }, { passive:true });
  })();
</script>

<!-- Bloqueo de scroll en móvil al abrir menú -->
<script>
  (function(){
    var origScrollTop = 0;
    function lockScroll(){
      origScrollTop = window.pageYOffset || document.documentElement.scrollTop || 0;
      document.body.style.top = (-origScrollTop) + 'px';
      document.body.classList.add('scroll-locked');
    }
    function unlockScroll(){
      document.body.classList.remove('scroll-locked');
      document.body.style.top = '';
      window.scrollTo(0, origScrollTop);
    }
    var menuBtn = document.getElementById('menuBtn');
    if(menuBtn){
      var prevClick = menuBtn.onclick;
      menuBtn.onclick = function(e){
        if(prevClick) prevClick.call(this, e);
        var open = document.body.classList.contains('nav-open');
        if(open) lockScroll(); else unlockScroll();
      };
    }
    var mq = window.matchMedia('(min-width: 992px)');
    function onMQ(){
      if(mq.matches){
        unlockScroll();
        document.body.classList.remove('nav-open');
      }
    }
    if(mq.addEventListener){ mq.addEventListener('change', onMQ); } else { mq.addListener(onMQ); }
  })();
</script>

{% block extra_js %}{% endblock %}
</body>
</html>
