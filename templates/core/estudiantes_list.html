{% extends "base.html" %}
{% block title %}Estudiantes{% endblock %}
{% block header %}Estudiantes{% endblock %}

{% block content %}
<div style="display:flex; gap:10px; align-items:center; margin-bottom:10px; flex-wrap:wrap;">
  <a class="btn" href="{% url 'core:estudiante_create' %}">‚ûï Nuevo estudiante</a>
  <form method="get" style="display:flex; gap:8px; align-items:center;">
    <input type="text" name="q" value="{{ q }}" placeholder="Buscar por RUT, nombre o email" style="padding:6px 8px; min-width:260px;">
    <button class="btn">Buscar</button>
  </form>
  {% if estudiantes %}
    <span style="margin-left:auto;">Mostrando {{ estudiantes|length }} registro{% if estudiantes|length != 1 %}s{% endif %}</span>
  {% endif %}
</div>

{% if estudiantes %}
  <div style="overflow:auto;">
    <table class="table table-striped" style="min-width:1100px;">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>RUT</th>
          <th>Edad</th>
          <th>Direcci√≥n</th>
          <th>Comuna</th>
          <th>Tel√©fono</th>
          <th>Email</th>
          <th>Organizaci√≥n</th>
          <th>Club</th>
          <th>Logros</th>
          <th>Categor√≠a</th>
          <th>Puntaje/Logro</th>
          <th>Curso</th>
          <th>Activo</th>
          <th style="min-width:160px;">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for e in estudiantes %}
        <tr>
          <td>{{ e.nombres }} {{ e.apellidos }}</td>
          <td>{{ e.rut }}</td>
          <td>{{ e.edad }}</td>
          <td>{{ e.direccion }}</td>
          <td>{{ e.comuna }}</td>
          <td>{{ e.telefono }}</td>
          <td>{{ e.email }}</td>
          <td>{{ e.pertenece_organizacion|yesno:"S√≠,No" }}</td>
          <td>{{ e.club_nombre }}</td>
          <td>
            {% if e.logro_nacional or e.logro_internacional %}
              {% if e.logro_nacional %}Nacional{% endif %}{% if e.logro_nacional and e.logro_internacional %} / {% endif %}{% if e.logro_internacional %}Internacional{% endif %}
            {% else %}
              ‚Äî
            {% endif %}
          </td>
          <td>{{ e.categoria_competida }}</td>
          <td>{{ e.puntaje_o_logro }}</td>
          <td>{{ e.curso }}</td>
          <td>{{ e.activo|yesno:"S√≠,No" }}</td>
          <td class="text-end">
            <a class="btn" href="{% url 'core:estudiante_edit' e.id %}">‚úèÔ∏è Editar</a>
            <form method="post" action="{% url 'core:estudiante_delete' e.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn" type="submit" onclick="return confirm('¬øEliminar este estudiante?');" style="background:#d9534f; color:white;">
                üóëÔ∏è Eliminar
              </button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <p>No hay estudiantes registrados.</p>
{% endif %}
{% endblock %}
