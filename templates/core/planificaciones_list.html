{% extends "base/plantilla.html" %}
{% block title %}Planificaciones{% endblock %}
{% block header %}Planificaciones{% endblock %}

{% block extra_css %}
<style>
  /* Alineación de filtros y acciones */
  .filters-row{ row-gap:.5rem; }
  .filters-row .form-label{ font-size:.85rem; margin-bottom:.2rem; }
  /* Columna de acciones en tabla a la derecha y con ancho fijo */
  .col-actions-th{ width:140px; text-align:right; }
  .col-actions-td{ text-align:right; }
  .actions-inline{ display:inline-flex; gap:.4rem; flex-wrap:wrap; justify-content:flex-end; }
</style>
{% endblock %}

{% block content %}

{% if messages %}
  {% for m in messages %}
    <div class="alert {% if m.tags %}alert-{{ m.tags }}{% endif %}">{{ m }}</div>
  {% endfor %}
{% endif %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h5 class="mb-0">Planificaciones de la semana {{ lunes|date:"d-m-Y" }}</h5>
  <a class="btn btn-primary" href="{% url 'core:planificacion_upload' %}">Subir planificación</a>
</div>

<form method="get" class="row filters-row align-items-end mb-3">
  <div class="col-auto">
    <label class="form-label mb-0 small">Semana</label>
    <input type="date" class="form-control" name="semana" value="{{ semana }}">
  </div>
  <div class="col-auto">
    <label class="form-label mb-0 small">Sede</label>
    <select class="form-select" name="sede">
      <option value="">Todas</option>
      {% for s in sedes %}
        <option value="{{ s.id }}" {% if s.id|stringformat:"s" == sede_id %}selected{% endif %}>{{ s.nombre }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto">
    <label class="form-label mb-0 small">Disciplina</label>
    <select class="form-select" name="disciplina">
      <option value="">Todas</option>
      {% for d in disciplinas %}
        <option value="{{ d.id }}" {% if d.id|stringformat:"s" == dep_id %}selected{% endif %}>{{ d.nombre }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto">
    <label class="form-label mb-0 small">Curso</label>
    <select class="form-select" name="curso">
      <option value="">Todos</option>
      {% for c in cursos %}
        <option value="{{ c.id }}" {% if c.id|stringformat:"s" == curso_id %}selected{% endif %}>
          {{ c.nombre }} – {{ c.disciplina.nombre }} – {{ c.sede.nombre }}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto">
    <button class="btn btn-outline-secondary" type="submit">Filtrar</button>
  </div>
</form>

{% if items %}
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>Curso</th>
          <th>Disciplina</th>
          <th>Sede</th>
          <th>Semana</th>
          <th>Pública</th>
          <th>Archivo</th>
          <th>Autor</th>
          <th class="col-actions-th">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for p in items %}
          <tr>
            <td>{{ p.curso.nombre }}</td>
            <td>{{ p.curso.disciplina.nombre }}</td>
            <td>{{ p.curso.sede.nombre }}</td>
            <td>{{ p.semana|date:"d-m-Y" }} ({{ p.semana_iso }})</td>
            <td>{% if p.publica %}Sí{% else %}No{% endif %}</td>
            <td>
              {% if p.archivo %}
                <a class="btn btn-sm btn-outline-secondary" href="{% url 'core:planificacion_download' p.id %}">Descargar</a>
              {% else %}
                —
              {% endif %}
            </td>
            <td>{{ p.autor }}</td>
            <td class="col-actions-td">
              <span class="actions-inline">
                <a class="btn btn-sm btn-outline-primary" href="{% url 'core:planificacion_detail' p.id %}">Ver</a>
              </span>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-info">No hay planificaciones para los filtros seleccionados.</div>
{% endif %}

{% endblock %}
