{% extends "base.html" %}
{% block title %}Cursos{% endblock %}
{% block header %}Cursos{% endblock %}

{% block content %}
  <p>
    <a class="btn" href="{% url 'core:curso_create' %}">âž• Nuevo curso</a>
  </p>

  {% if cursos %}
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Programa</th>
        <th>Disciplina</th>
        <th>Profesor</th>
        <th>Horario</th>
        <th>Sede</th>
        <th>Cupos</th>
        <th>AcciÃ³n</th>  {# ðŸ‘ˆ NUEVO #}
      </tr>
    </thead>
    <tbody>
      {% for c in cursos %}
      <tr>
        <td>{{ c.nombre }}</td>
        <td>{{ c.get_programa_display }}</td>
        <td>{{ c.disciplina }}</td>
        <td>{{ c.profesor.get_full_name|default:c.profesor.username }}</td>
        <td>
          {# Si tienes objetos CursoHorario, los puedes listar aquÃ­ #}
          {% for h in c.cursohorario_set.all %}
            {{ h.get_dia_display }} {{ h.hora_inicio|time:"H:i" }}â€“{{ h.hora_fin|time:"H:i" }}{% if not forloop.last %}<br>{% endif %}
          {% empty %}
            â€”
          {% endfor %}
        </td>
        <td>{{ c.sede }}</td>
        <td>
          {% if c.cupos %}
            {{ c.cupos_ocupados }}/{{ c.cupos }}
          {% else %}
            â€”
          {% endif %}
        </td>

        {# ===================== ACCIÃ“N: INSCRIBIR ===================== #}
        <td>
          {% if alumno %}
            <form method="post" action="{% url 'core:inscribir_en_curso' c.id alumno.id %}" style="display:inline;">
              {% csrf_token %}
              <button class="btn">Inscribir</button>
            </form>
            {% if c.cupos %}
              <div class="text-muted" style="font-size:12px;">
                Disp: {{ c.cupos_disponibles }}
              </div>
            {% endif %}
          {% else %}
            <span class="text-muted" style="font-size:12px;">
              Selecciona un alumno para inscribir.
            </span>
          {% endif %}
        </td>
        {# ============================================================ #}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p class="text-muted">No hay cursos creados.</p>
  {% endif %}
{% endblock %}
