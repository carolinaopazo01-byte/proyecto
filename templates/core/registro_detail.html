{% extends "base/plantilla.html" %}
{% block title %}Postulación{% endblock %}
{% block header %}Postulación de {{ p.nombres }} {{ p.apellidos }}{% endblock %}

{% block extra_css %}
<style>
  .postu-shell{ max-width:900px; }
  .postu-meta dt{ width:170px; color:#6b7280; font-weight:600; }
  .postu-meta dd{ margin-bottom:.5rem; }
  .postu-title{ font-weight:700; font-size:.95rem; margin:0 0 .5rem 0; color:#111827; }
  .postu-sep{ margin:.75rem 0; }

  .badge-state{ font-weight:600; }
  .text-dash{ color:#9aa4b2; }

  .actions{ display:flex; gap:.5rem; flex-wrap:wrap; }
  .actions form{ margin:0; }
  .actions .btn{ padding:.35rem .6rem; line-height:1.1; border-radius:8px; font-size:.875rem; }

  @media (max-width: 576px){
    .postu-meta dt{ width:120px; }
  }
</style>
{% endblock %}

{% block content %}
<div class="card shadow-sm postu-shell">
  <div class="card-body">

    <!-- ===== Datos del/la postulante ===== -->
    <h6 class="postu-title">Datos del/la postulante</h6>
    <dl class="row postu-meta">
      <dt class="col-sm-4 col-md-3">Programa</dt>
      <dd class="col-sm-8 col-md-9">{{ p.get_programa_display }}</dd>

      <dt class="col-sm-4 col-md-3">Estado</dt>
      <dd class="col-sm-8 col-md-9">
        {% if p.estado == "PEND" %}
          <span class="badge badge-state bg-warning text-dark">Pendiente</span>
        {% elif p.estado == "APRO" %}
          <span class="badge badge-state bg-success">Aprobada</span>
        {% elif p.estado == "RECH" %}
          <span class="badge badge-state bg-secondary">Rechazada</span>
        {% else %}
          <span class="badge badge-state bg-light text-dark">{{ p.get_estado_display }}</span>
        {% endif %}
      </dd>

      <dt class="col-sm-4 col-md-3">RUT</dt>
      <dd class="col-sm-8 col-md-9">{{ p.rut }}</dd>

      <dt class="col-sm-4 col-md-3">Fecha nac.</dt>
      <dd class="col-sm-8 col-md-9">{{ p.fecha_nacimiento|date:"d/m/Y" }}</dd>

      <dt class="col-sm-4 col-md-3">Contacto</dt>
      <dd class="col-sm-8 col-md-9">{{ p.email|default:"—" }} · {{ p.telefono|default:"—" }}</dd>

      <dt class="col-sm-4 col-md-3">N° emergencia</dt>
      <dd class="col-sm-8 col-md-9">{{ p.n_emergencia|default:"—" }}</dd>

      <dt class="col-sm-4 col-md-3">Previsión</dt>
      <dd class="col-sm-8 col-md-9">{{ p.get_prevision_display }}</dd>

      <dt class="col-sm-4 col-md-3">Dirección</dt>
      <dd class="col-sm-8 col-md-9">
        {% if p.direccion or p.comuna %}
          {{ p.direccion|default:"—" }}{% if p.direccion and p.comuna %}, {% endif %}{{ p.comuna|default:"—" }}
        {% else %}
          <span class="text-dash">—</span>
        {% endif %}
      </dd>
    </dl>

    <hr class="postu-sep">

    <!-- ===== Información deportiva ===== -->
    <h6 class="postu-title">Información deportiva</h6>
    <dl class="row postu-meta">
      <dt class="col-sm-4 col-md-3">Organización</dt>
      <dd class="col-sm-8 col-md-9">
        {% if p.pertenece_organizacion %}
          <span class="badge bg-success">Sí</span>{% if p.club_nombre %}<span class="text-muted"> — {{ p.club_nombre }}</span>{% endif %}
        {% else %}
          <span class="badge bg-secondary">No</span>
        {% endif %}
      </dd>

      <dt class="col-sm-4 col-md-3">Logros</dt>
      <dd class="col-sm-8 col-md-9">
        {% if p.logro_nacional or p.logro_internacional %}
          {% if p.logro_nacional %}Nacional{% endif %}{% if p.logro_nacional and p.logro_internacional %} / {% endif %}{% if p.logro_internacional %}Internacional{% endif %}
        {% else %}
          <span class="text-dash">—</span>
        {% endif %}
      </dd>

      <dt class="col-sm-4 col-md-3">Categoría</dt>
      <dd class="col-sm-8 col-md-9">{{ p.categoria_competida|default:"—" }}</dd>

      <dt class="col-sm-4 col-md-3">Puntaje/Logro</dt>
      <dd class="col-sm-8 col-md-9">{{ p.puntaje_o_logro|default:"—" }}</dd>

      <dt class="col-sm-4 col-md-3">Motivación</dt>
      <dd class="col-sm-8 col-md-9">
        <div class="p-3 border rounded" style="white-space:pre-wrap;">
          {{ p.motivacion_beca|default:"—" }}
        </div>
      </dd>
    </dl>

    <hr class="postu-sep">

    <!-- ===== Curso ===== -->
    <h6 class="postu-title">Curso</h6>
    <dl class="row postu-meta">
      <dt class="col-sm-4 col-md-3">Curso</dt>
      <dd class="col-sm-8 col-md-9">{{ p.curso|default:"—" }}</dd>

      <dt class="col-sm-4 col-md-3">Activo</dt>
      <dd class="col-sm-8 col-md-9">
        {% if p.activo %}<span class="badge bg-success">Sí</span>{% else %}<span class="badge bg-secondary">No</span>{% endif %}
      </dd>
    </dl>

    <!-- ===== Acciones ===== -->
    <div class="actions mt-2">
      {% if p.estado == "PEND" %}
        <form method="post" action="{% url 'core:registro_aprobar' p.id %}">
          {% csrf_token %}
          <button class="btn btn-outline-success" type="submit">
            <i class="fas fa-check"></i> Aprobar
          </button>
        </form>
        <form method="post" action="{% url 'core:registro_rechazar' p.id %}" onsubmit="return confirm('¿Rechazar esta postulación?');">
          {% csrf_token %}
          <button class="btn btn-outline-danger" type="submit">
            <i class="fas fa-times"></i> Rechazar
          </button>
        </form>
      {% elif p.estado == "APRO" and p.estudiante_creado %}
        <span class="text-success">
          Aprobada. Estudiante creado:
          <b>{{ p.estudiante_creado.nombres }} {{ p.estudiante_creado.apellidos }}</b>
        </span>
      {% else %}
        <span class="text-muted">Postulación {{ p.get_estado_display }}.</span>
      {% endif %}
    </div>

  </div>
</div>
{% endblock %}
