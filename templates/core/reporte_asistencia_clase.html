{% extends "base/plantilla.html" %}

{% block title %}Asistencia por clase{% endblock %}

{% block extra_css %}
<style>
  .page-head { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:.75rem; }
  .page-head-left { display:flex; align-items:center; gap:10px; }

  /* Filtros compactos en grid, consistente con otros listados/reportes */
  .filters-grid{
    display:grid;
    grid-template-columns: 160px 200px 200px 180px 1fr;
    gap:10px;
    align-items:end;
  }
  @media (max-width: 1200px){
    .filters-grid{ grid-template-columns: repeat(2, minmax(220px,1fr)); }
  }
  @media (max-width: 576px){
    .filters-grid{ grid-template-columns: 1fr; }
  }
  .form-label{ font-weight:600; font-size:.9rem; margin-bottom:.2rem; }
  .filters-grid input[type="date"],
  .filters-grid select,
  .filters-grid .form-control{
    height:2.35rem; font-size:.92rem;
  }
</style>
{% endblock %}

{% block content %}

  <!-- Cabecera alineada (sin botón Atrás local) -->
  <div class="page-head">
    <div class="page-head-left">
      <h4 class="mb-0">Asistencia por clase</h4>
    </div>
  </div>

  <!-- Filtros -->
  <form method="get" class="card p-3 mb-3">
    <div class="filters-grid">
      <div>
        <label class="form-label">Fecha</label>
        <input type="date" name="fecha" value="{{ fecha }}" class="form-control">
      </div>

      <div>
        <label class="form-label">Sede</label>
        <select name="sede" class="form-control">
          <option value="">Todas</option>
          {% for s in sedes %}
            <option value="{{ s.id }}" {% if s.id|stringformat:"s" == request.GET.sede %}selected{% endif %}>{{ s.nombre }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label class="form-label">Disciplina</label>
        <select name="disciplina" class="form-control">
          <option value="">Todas</option>
          {% for d in disciplinas %}
            <option value="{{ d.id }}" {% if d.id|stringformat:"s" == request.GET.disciplina %}selected{% endif %}>{{ d.nombre }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label class="form-label">Marcada por</label>
        <select name="marcador" class="form-control">
          <option value="" {% if request.GET.marcador == "" %}selected{% endif %}>Todos</option>
          <option value="prof" {% if request.GET.marcador == "prof" %}selected{% endif %}>Profesor</option>
          <option value="alum" {% if request.GET.marcador == "alum" %}selected{% endif %}>Alumno</option>
        </select>
      </div>

      <div>
        <label class="form-label">Clase</label>
        <select name="clase" class="form-control">
          <option value="">Seleccione…</option>
          {% for c in clases %}
            <option value="{{ c.id }}" {% if c.id == clase_id %}selected{% endif %}>
              {{ c.fecha }} · {{ c.sede_deporte.sede }} · {{ c.sede_deporte.deporte }} · {{ c.profesor }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div style="grid-column:1/-1; display:flex; gap:8px; margin-top:6px;">
        <button class="btn btn-primary" type="submit">Ver</button>
        {% if seleccionada %}
          <button class="btn btn-outline-secondary" onclick="window.print(); return false;">Imprimir lista</button>
        {% endif %}
      </div>
    </div>
  </form>

  {% if seleccionada %}
    <div class="card">
      <div class="card-body">
        <h6 class="mb-3">
          Clase: {{ seleccionada.fecha }} · {{ seleccionada.sede_deporte.sede }} · {{ seleccionada.sede_deporte.deporte }} · {{ seleccionada.profesor }}
        </h6>

        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="thead-light">
              <tr>
                <th>RUT</th>
                <th>Nombre</th>
                <th>Estado</th>
                <th>Observación</th>
              </tr>
            </thead>
            <tbody>
              {% for r in registros %}
                <tr>
                  <td>{{ r.atleta.rut }}</td>
                  <td>{{ r.atleta.usuario.get_full_name }}</td>
                  <td>{% if r.presente %}Presente{% else %}Ausente{% endif %}</td>
                  <td>{{ r.observaciones }}</td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="4" class="text-center text-muted">Sin registros de asistencia.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  {% endif %}

{% endblock %}
