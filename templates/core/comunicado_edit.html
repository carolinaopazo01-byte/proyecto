{% extends "base/plantilla.html" %}
{% load static %}

{% block title %}Editar Comunicado{% endblock %}

{% block extra_css %}
<link href="{% static 'css/cpc-uniform.css' %}" rel="stylesheet">
<style>
  :root{
    --sp-xs:.35rem; --sp-sm:.6rem;
    --fs-xs:.84rem; --fs-sm:.92rem;
    --radius:10px;
    --border:#e5e7eb; --bg-head:#f8fafc;
  }
  .btn-compact{ padding:.35rem .7rem; border-radius:8px; }

  .cpc-ph-shell{ width:100%; padding-left:16px; padding-right:16px; margin:0 0 .75rem 0; }
  .cpc-ph{
    height:56px; display:grid; grid-template-columns: 1fr 180px;
    align-items:center; column-gap:12px;
  }
  .cpc-ph__title{
    margin:0; line-height:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    font-size:clamp(16px, 2.8vw, 20px); justify-self:start;
  }

  .section{ background:#fff; border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; }
  .section__head{ padding:.55rem .8rem; background:var(--bg-head); border-bottom:1px solid #eef2f7; }
  .section__title{ font-size:.95rem; font-weight:700; margin:0; }
  .section__body{ padding:.9rem; }

  .form-stack{ display:flex; flex-direction:column; gap:.75rem; max-width:760px; }
  .form-label{ font-weight:600; font-size:var(--fs-xs); margin-bottom:.25rem; }
  input[type="text"], textarea, select, .checkboxes{
    width:100%; font-size:var(--fs-sm);
  }
  input[name="titulo"], textarea[name="cuerpo"]{
    padding:.55rem .65rem; border:1px solid #d1d5db; border-radius:10px; background:#fff;
    transition: box-shadow .12s ease, border-color .12s ease;
  }
  textarea[name="cuerpo"]{ min-height:180px; line-height:1.4; }
  input[name="titulo"]:focus, textarea[name="cuerpo"]:focus{
    border-color:#056375; box-shadow:0 0 0 .2rem rgba(5,99,117,.28); outline:none;
  }

  .checkboxes ul{ margin:0; padding-left:0; list-style:none; display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:.25rem .75rem; }
  .checkboxes li{ display:flex; align-items:center; gap:.5rem; }
  .help{ color:#6b7280; font-size:.85rem; }

  .actions-wrap{
    position: sticky; bottom:16px; z-index:20; display:flex; justify-content:center; gap:.5rem;
    padding:.6rem .8rem; max-width:980px; margin:1rem auto 0;
    border:1px solid #e5e7eb; border-radius:12px; background:rgba(255,255,255,.95);
    backdrop-filter:saturate(120%) blur(4px); box-shadow:0 6px 20px rgba(0,0,0,.08);
  }

  .err{ color:#b00020; margin-top:.25rem; font-size:.85rem; }
</style>
{% endblock %}

{% block content %}
  <div class="cpc-ph-shell">
    <div class="cpc-ph">
      <h4 class="cpc-ph__title">Editar Comunicado</h4>
      <div></div>
    </div>
  </div>

  <form method="post" novalidate>
    {% csrf_token %}

    <section class="section">
      <div class="section__head">
        <h6 class="section__title">Datos del comunicado</h6>
      </div>
      <div class="section__body">
        <div class="form-stack">
          <div>
            <label class="form-label" for="{{ form.titulo.id_for_label }}">Título</label>
            {{ form.titulo }}
            {% if form.titulo.errors %}<div class="err">{{ form.titulo.errors }}</div>{% endif %}
          </div>

          <div>
            <label class="form-label" for="{{ form.cuerpo.id_for_label }}">Cuerpo</label>
            {{ form.cuerpo }}
            {% if form.cuerpo.errors %}<div class="err">{{ form.cuerpo.errors }}</div>{% endif %}
          </div>

          <div>
            <label class="form-label">¿A quién va dirigido?</label>
            <div class="checkboxes">
              {{ form.audiencia_codigos }}
            </div>
            <div class="help">Marca uno o más: PROF, PMUL, ATLE, APOD.</div>
            {% if form.audiencia_codigos.errors %}<div class="err">{{ form.audiencia_codigos.errors }}</div>{% endif %}
          </div>

          <div>
            <label class="form-label" for="{{ form.audiencia_roles.id_for_label }}">Grupos (opcional)</label>
            {{ form.audiencia_roles }}
            <div class="help">Usa sólo si creaste grupos llamados exactamente: PROF, PMUL, ATLE, APOD.</div>
            {% if form.audiencia_roles.errors %}<div class="err">{{ form.audiencia_roles.errors }}</div>{% endif %}
          </div>
        </div>
      </div>
    </section>

    <div class="actions-wrap">
      <a class="btn btn-light btn-compact" href="{% url 'core:comunicados_list' %}">Cancelar</a>
      <button class="btn btn-primary btn-compact" type="submit">Guardar cambios</button>
    </div>
  </form>
{% endblock %}
