{% extends "base/plantilla.html" %}
{% load static %}

{% block title %}Asistencia{% endblock %}
{% block header %}
Asistencia â€” {{ curso.nombre|default:"(Curso)" }}{% if clase %} ({{ clase.fecha|date:"d/m/Y" }}){% endif %}
{% endblock %}

{% block content %}

{% if messages %}
  <ul class="messages">
    {% for m in messages %}
      <li class="message {{ m.tags }}">{{ m }}</li>
    {% endfor %}
  </ul>
{% endif %}

<div class="card" style="padding:12px;margin-bottom:12px;">
  <p style="margin-top:0;">
    Estado:
    <strong>
      {% if clase and clase.estado == "PEND" %}Pendiente
      {% elif clase and clase.estado == "ENCU" %}En curso
      {% elif clase %}Cerrada
      {% else %}â€”{% endif %}
    </strong>
    {% if clase and clase.inicio_real %} Â· Inicio real: {{ clase.inicio_real|date:"H:i" }}{% endif %}
    {% if clase and clase.fin_real %} Â· Fin real: {{ clase.fin_real|date:"H:i" }}{% endif %}
  </p>

  <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px;">
    <form method="post" style="display:inline;">
      {% csrf_token %}
      <input type="hidden" name="accion" value="entrada">
      <button class="btn btn-primary">âœ… Registrar entrada</button>
    </form>

    <form method="post" style="display:inline;">
      {% csrf_token %}
      <input type="hidden" name="accion" value="salida">
      <button class="btn btn-secondary">â¹ï¸ Registrar salida</button>
    </form>
  </div>

  <div style="margin-top:10px; font-weight:600;">
    Resumen guardado:
    <span>{{ resumen.P|default:0 }} presentes</span> Â·
    <span>{{ resumen.A|default:0 }} ausentes</span> Â·
    <span>{{ resumen.J|default:0 }} justificados</span>
    <span style="color:#666;">(de {{ resumen.total|default:0 }})</span>
  </div>

  <form method="post">
    {% csrf_token %}
    <input type="hidden" name="accion" value="guardar">

    <table class="table">
      <thead>
        <tr>
          <th>Alumno</th>
          <th>Presente</th>
          <th>Ausente</th>
          <th>Justificado</th>
          <th>Observaciones</th>
        </tr>
      </thead>
    <tbody>
  {% for row in rows %}
    <tr>
      <td>{{ row.nombre }}</td>
      <td><input type="radio" name="estado_{{ row.ins.id }}" value="P" {% if row.code == "P" %}checked{% endif %}></td>
      <td><input type="radio" name="estado_{{ row.ins.id }}" value="A" {% if row.code == "A" %}checked{% endif %}></td>
      <td><input type="radio" name="estado_{{ row.ins.id }}" value="J" {% if row.code == "J" %}checked{% endif %}></td>
      <td><input type="text" name="obs_{{ row.ins.id }}" value="{{ row.obs }}" style="width:100%"></td>
    </tr>
  {% empty %}
    <tr><td colspan="5">No hay alumnos inscritos.</td></tr>
  {% endfor %}
</tbody>
    </table>

    <button class="btn btn-success">ğŸ’¾ Guardar asistencia alumnos</button>
  </form>
</div>

{% endblock %}
