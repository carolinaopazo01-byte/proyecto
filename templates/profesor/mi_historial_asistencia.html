{% extends "base/plantilla.html" %}
{% block title %}Mi historial de asistencia{% endblock %}
{% block header %}ðŸ“Š Mi historial de asistencia{% endblock %}

{% block extra_css %}
<style>
  .hist-card{
    max-width: 980px;
    margin: 0 auto;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,.05);
  }
  /* Barra de filtros compacta y pegajosa */
  .filters{
    display:flex; gap:8px; flex-wrap:wrap; align-items:center;
    margin-bottom:10px;
    position: sticky; top: 8px; z-index: 5;
    background: var(--bs-body-bg, #fff);
    padding: 8px; border:1px solid #e5e7eb; border-radius:10px;
  }
  .filters .input{ min-width: 180px; }
  .filters .btn{ font-weight: 700; }

  /* Tabla limpia y legible */
  .table thead th{
    white-space:nowrap;
    background:#f8fafc;
    border-bottom:1px solid #e5e7eb;
  }
  .table tbody td{ vertical-align: middle; }

  /* Badges para tipo */
  .badge-ent{ background:#ecfdf5; color:#065f46; border:1px solid #a7f3d0; font-weight:800; }
  .badge-sal{ background:#eff6ff; color:#1e40af; border:1px solid #bfdbfe; font-weight:800; }

  /* Responsive fino */
  @media (max-width: 576px){
    .filters{ top: 6px; padding: 8px; }
    .filters .input{ min-width: 0; flex: 1 1 140px; }
    .filters .btn{ width: 100%; }
    .table-responsive{ border: 1px solid #e5e7eb; border-radius: 10px; }
  }
</style>
{% endblock %}

{% block content %}
<div class="card p-3 hist-card">

  <!-- Filtros -->
  <form method="get" class="filters">
    <input type="date" name="ini" value="{{ f_ini }}" class="input form-control form-control-sm">
    <input type="date" name="fin" value="{{ f_fin }}" class="input form-control form-control-sm">
    <select name="sede" class="input form-select form-select-sm">
      <option value="">Todas las sedes</option>
      {% for s in sedes %}
        <option value="{{ s.id }}" {% if s.id == sede_sel %}selected{% endif %}>{{ s.nombre }}</option>
      {% endfor %}
    </select>
    <button class="btn btn-primary btn-sm">Filtrar</button>
    {% if f_ini or f_fin or sede_sel %}
      <a class="btn btn-outline-secondary btn-sm" href="?">Limpiar</a>
    {% endif %}
  </form>

  <div class="table-responsive">
    <table class="table table-striped table-sm align-middle mb-0">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Tipo</th>
          <th>Hora</th>
          <th>Sede</th>
          <th>Estado</th>
        </tr>
      </thead>
      <tbody>
        {% for i in items %}
          <tr>
            <td>{{ i.fecha|date:"d-m-Y" }}</td>
            <td>
              {% if i.tipo == "ENT" %}
                <span class="badge badge-ent">Entrada</span>
              {% else %}
                <span class="badge badge-sal">Salida</span>
              {% endif %}
            </td>
            <td>{{ i.hora|time:"H:i" }}</td>
            <td>{{ i.sede.nombre }}</td>
            <td>âœ…</td>
          </tr>
        {% empty %}
          <tr><td colspan="5" class="text-center text-muted">Sin registros.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
